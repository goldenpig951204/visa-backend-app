(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2729],{76779:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var s=n(63366),r=n(87462),l=n(67294),i=n(86010),a=n(94780),c=n(67074),o=n(78884),d=n(1588),m=n(34867);function x(e){return(0,m.Z)("MuiDialogActions",e)}(0,d.Z)("MuiDialogActions",["root","spacing"]);var u=n(85893);let h=["className","disableSpacing"],j=e=>{let{classes:t,disableSpacing:n}=e;return(0,a.Z)({root:["root",!n&&"spacing"]},x,t)},Z=(0,c.ZP)("div",{name:"MuiDialogActions",slot:"Root",overridesResolver(e,t){let{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})(({ownerState:e})=>(0,r.Z)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!e.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})),f=l.forwardRef(function(e,t){let n=(0,o.Z)({props:e,name:"MuiDialogActions"}),{className:l,disableSpacing:a=!1}=n,c=(0,s.Z)(n,h),d=(0,r.Z)({},n,{disableSpacing:a}),m=j(d);return(0,u.jsx)(Z,(0,r.Z)({className:(0,i.Z)(m.root,l),ownerState:d,ref:t},c))});var p=f},64075:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crms/contacts",function(){return n(44702)}])},44702:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var s=n(85893),r=n(67294),l=n(17288),i=n(80562),a=n(73812),c=n(31538),o=n(29630),d=n(79072),m=n(49837),x=n(59742),u=n(61953),h=n(91359),j=n(21609),Z=n(98966),f=n(94314),p=n(5464),g=n(30381),C=n.n(g),y=n(86501),w=n(1890),N=n(77745),S=n(95398),b=n(44373),v=n(76779),_=n(75084);let M=e=>{let{show:t,contact:n,init:r,onInit:l,onClose:a}=e;return(0,s.jsxs)(w.Z,{fullWidth:!0,maxWidth:"md",onClose:a,open:t,children:[(0,s.jsxs)(N.Z,{children:["Contact Mail",(0,s.jsx)(i.Z,{onClick:a,sx:{position:"absolute",right:18,top:18,color:"#aaa"},children:(0,s.jsx)(j.Z,{icon:"mdi:close"})})]}),(0,s.jsx)(S.Z,{sx:{p:6},children:Object.keys(n).length>0&&(0,s.jsxs)(u.Z,{children:[(0,s.jsxs)(u.Z,{children:[(0,s.jsx)(b.Z,{}),(0,s.jsx)(o.Z,{variant:"h6",children:n.subject}),(0,s.jsx)(o.Z,{component:"p",sx:{my:5},children:n.message}),(0,s.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(o.Z,{component:"p",children:["From: ",n.name," (",n.email,")"]}),(0,s.jsxs)(o.Z,{component:"p",sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"mdi:calendar"})," ",C()(n.createdAt).format("DD/MM/YYYY HH:mm:ss")]})]}),(0,s.jsx)(b.Z,{})]}),n.replyContacts.map((e,t)=>(0,s.jsxs)(u.Z,{sx:{pl:10},children:[(0,s.jsx)(o.Z,{component:"p",sx:{mb:3},children:e.message}),(0,s.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(o.Z,{component:"p",children:["From: ",e.users[0].firstName," ",e.users[0].lastName," (",e.users[0].email,")"]}),(0,s.jsxs)(o.Z,{component:"p",sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"mdi:calendar"})," ",C()(e.createdAt).format("DD/MM/YYYY HH:mm:ss")]})]}),(0,s.jsx)(b.Z,{})]},t))]})}),(0,s.jsx)(v.Z,{children:(0,s.jsx)(_.Z,{variant:"contained",color:"error",size:"large",startIcon:(0,s.jsx)(j.Z,{icon:"mdi:close"}),onClick:a,children:"Close"})})]})};var A=n(55343),Y=n(67836);let k=e=>{let{open:t,contact:n,onClose:a}=e,{user:c}=(0,l.a)(),[o,d]=(0,r.useState)(""),m=async()=>{if(""===o.trim())y.Am.error("Please put down the reply content.");else{let{data:e}=await p.Z.post("/crms/reply-contacts",{message:o,admin:c._id,contact:n._id});e.status?(y.Am.success(e.msg),d(""),a(!1)):y.Am.error(e.msg)}};return(0,s.jsxs)(w.Z,{open:t,fullWidth:!0,maxWidth:"sm",children:[(0,s.jsxs)(N.Z,{children:["Reply to a contact request",(0,s.jsx)(i.Z,{onClick:a,sx:{position:"absolute",right:18,top:18,color:"#aaa"},children:(0,s.jsx)(j.Z,{icon:"mdi:close"})})]}),(0,s.jsx)(S.Z,{children:(0,s.jsx)(A.Z,{fullWidth:!0,sx:{mt:2},children:(0,s.jsx)(Y.Z,{multiline:!0,label:"Reply content",value:o,onChange:e=>d(e.target.value),rows:4,maxRows:8})})}),(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(_.Z,{variant:"contained",onClick:m,children:"Reply Now"}),(0,s.jsx)(_.Z,{variant:"contained",color:"error",onClick:a,children:"Cancel"})]})]})},D=e=>{let{row:t,onReply:n,onDelete:l}=e,[o,d]=(0,r.useState)(null),m=Boolean(o),x=e=>{e.stopPropagation(),d(e.currentTarget)},u=()=>{d(null)},h=()=>{n(t),u()},Z=()=>{l(t._id),u()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{size:"small",onClick:x,children:(0,s.jsx)(j.Z,{icon:"mdi:dots-vertical"})}),(0,s.jsxs)(a.Z,{keepMounted:!0,anchorEl:o,open:m,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{style:{minWidth:"8rem"}},children:[(0,s.jsxs)(c.Z,{sx:{"& svg":{mr:2}},onClick:h,children:[(0,s.jsx)(j.Z,{icon:"mdi:reply",fontSize:20})," Reply"]}),(0,s.jsxs)(c.Z,{sx:{"& svg":{mr:2}},onClick:Z,children:[(0,s.jsx)(j.Z,{icon:"mdi:delete-outline",fontSize:20})," Delete"]})]})]})},R=()=>{let{user:e}=(0,l.a)(),[t,n]=(0,r.useState)([]),[i,a]=(0,r.useState)(!0),[c,j]=(0,r.useState)(""),[f,g]=(0,r.useState)(10),[w,N]=(0,r.useState)(!1),[S,b]=(0,r.useState)([]),[v,_]=(0,r.useState)(""),[A,Y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let t=async()=>{let{data:t}=await p.Z.get("crms/contacts",{params:{userId:e._id,search:c}});b(t)};t(),"super_admin"===e.role||"admin"===e.role?n([{flex:3,field:"name",headerName:"Name",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.name})}},{flex:6,field:"email",headerName:"Email",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.email})}},{flex:4,field:"subject",headerName:"Subject",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.subject})}},{flex:4,field:"message",headerName:"Message",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.message})}},{flex:3,field:"createdAt",headerName:"Sent date",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:C()(t.createdAt).format("YYYY.MM.DD HH:mm:ss")})}},{flex:1,field:"action",headerName:"Action",renderCell(e){let{row:t}=e;return(0,s.jsx)(D,{row:t,onReply:I,onDelete:P})}}]):n([{flex:4,field:"name",headerName:"Name",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.name})}},{flex:6,field:"email",headerName:"Email",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.email})}},{flex:6,field:"subject",headerName:"Subject",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.subject})}},{flex:6,field:"message",headerName:"Message",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:t.message})}},{flex:2,field:"createdAt",headerName:"Sent date",renderCell(e){let{row:t}=e;return(0,s.jsx)(o.Z,{children:C()(t.createdAt).format("YYYY.MM.DD HH:mm:ss")})}}])},[i]);let R=async e=>{let{row:t}=e;_(t),N(!0)},I=async e=>{_(e),Y(!0)},P=async e=>{let{data:t}=await p.Z.delete("crms/contacts/".concat(e));t.status?(y.Am.success(t.msg),a(!i)):y.Am.error(t.msg)};return(0,s.jsx)(d.ZP,{container:!0,spacing:6,children:(0,s.jsx)(d.ZP,{item:!0,xs:12,children:(0,s.jsxs)(m.Z,{children:[(0,s.jsx)(x.Z,{title:(0,s.jsx)(u.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:(0,s.jsx)(o.Z,{variant:"h5",children:"Contact Mails"})})}),(0,s.jsxs)(h.Z,{children:[(0,s.jsx)(u.Z,{children:(0,s.jsx)(Z._,{autoHeight:!0,getRowId:e=>e._id,columns:t,rows:S,onRowClick:R,pageSize:f,onPageSizeChange:e=>g(e)})}),(0,s.jsx)(M,{show:w,contact:v,init:i,onInit:a,onClose:()=>N(!1)}),(0,s.jsx)(k,{open:A,contact:v,onClose:()=>Y(!1)})]})]})})})};R.getLayout=e=>(0,s.jsx)(f.Z,{children:e});var I=R}},function(e){e.O(0,[4885,6284,9799,4583,8515,3344,7836,9072,9317,7985,4314,9774,2888,179],function(){return e(e.s=64075)}),_N_E=e.O()}]);