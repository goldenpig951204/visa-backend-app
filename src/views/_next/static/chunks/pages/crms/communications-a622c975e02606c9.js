(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9185],{73688:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crms/communications",function(){return r(58030)}])},58030:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return B}});var i=r(85893),s=r(67294),a=r(61953),n=r(64631),o=r(33821),l=r(44731),d=r(67836),c=r(9041),x=r(29630),h=r(85214),p=r(81284),m=r(95309),u=r(19594),g=r(61702),f=r(21448),b=r(17288),j=r(21609),Z=r(51964),v=r.n(Z),w=r(5464);let y=e=>{let{children:t,hidden:r}=e;return r?(0,i.jsx)(a.Z,{sx:{height:"100%",overflow:"auto"},children:t}):(0,i.jsx)(v(),{options:{wheelPropagation:!1},children:t})},C=e=>{let{hidden:t,handleChatClick:r}=e,{user:Z}=(0,b.a)(),[v,C]=(0,s.useState)(""),[S,k]=(0,s.useState)([]);(0,s.useEffect)(()=>{let e=async()=>{let{data:e}=await w.Z.get("crms/communications/contacts",{params:{id:Z._id}});k(e)};e()},[]);let _=e=>{k(S.map(t=>(t._id===e._id&&(t.unSeenCount=0),t))),C(e._id),r(e)};return(0,i.jsxs)(n.ZP,{open:!0,variant:"permanent",sx:{zIndex:7,height:"100%",display:"block",position:"static","& .MuiDrawer-paper":{boxShadow:"none",overflow:"hidden",width:360,position:"static",borderTopLeftRadius:e=>e.shape.borderRadius,borderBottomLeftRadius:e=>e.shape.borderRadius},"& > .MuiBackdrop-root":{borderRadius:1,position:"absolute",zIndex:e=>e.zIndex.drawer-1}},children:[(0,i.jsxs)(a.Z,{sx:{px:5.5,py:3.5,display:"flex",alignItems:"center",borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:[(0,i.jsx)(o.Z,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{mr:4.5},badgeContent:(0,i.jsx)(a.Z,{component:"span",sx:{width:8,height:8,borderRadius:"50%",color:"success.main",backgroundColor:"success.main",boxShadow:e=>"0 0 0 2px ".concat(e.palette.background.paper)}}),children:(0,i.jsx)(l.Z,{src:"/images/avatars/1.png",alt:Z.firstName,sx:{width:40,height:40,cursor:"pointer"}})}),(0,i.jsx)(d.Z,{fullWidth:!0,size:"small",value:"",onChange(){},placeholder:"Search for contact...",sx:{"& .MuiInputBase-root":{borderRadius:5}},InputProps:{startAdornment:(0,i.jsx)(c.Z,{position:"start",children:(0,i.jsx)(j.Z,{icon:"mdi:magnify",fontSize:"1.25rem"})})}})]}),(0,i.jsx)(a.Z,{sx:{height:"calc(100vh - 240px)"},children:(0,i.jsx)(y,{hidden:t,children:(0,i.jsxs)(a.Z,{sx:{p:e=>e.spacing(5,3,3)},children:[(0,i.jsx)(x.Z,{variant:"h6",sx:{ml:2,mb:4,color:"primary.main"},children:"Contacts"}),(0,i.jsx)(h.Z,{sx:{p:0},children:S.length>0&&S.map((e,t)=>(0,i.jsx)(p.ZP,{disablePadding:!0,sx:{"&:not(:last-child)":{mb:1.5}},children:(0,i.jsxs)(m.Z,{disableRipple:!0,onClick(){_(e)},sx:{px:2.5,py:2.5,width:"100%",borderRadius:1,alignItems:"flex-start",...v==e._id&&{backgroundColor:e=>"".concat(e.palette.primary.main," !important")}},children:[(0,i.jsx)(u.Z,{sx:{m:0},children:(0,i.jsx)(l.Z,{alt:"Avatar",src:"/images/avatars/2.png",sx:{width:40,height:40,outline:e=>"2px solid ".concat(e.palette.common.white,"}")}})}),(0,i.jsx)(g.Z,{sx:{my:0,ml:4},primary:(0,i.jsx)(x.Z,{sx:{color:"text.secondary"},children:e.firstName+" "+e.lastName}),secondary:(0,i.jsx)(x.Z,{noWrap:!0,variant:"body2",sx:{color:"text.disabled"},children:e.role})}),(0,i.jsx)(a.Z,{sx:{display:"flex",alignItems:"flex-end",flexDirection:"column",justifyContent:"flex-start"},children:e.unSeenCount?(0,i.jsx)(f.Z,{color:"error",label:e.unSeenCount,sx:{mt:.5,height:18,fontWeight:600,fontSize:"0.75rem","& .MuiChip-label":{pt:.25,px:1.655}}}):null})]})},t))})]})})})]})};var S=r(80562),k=r(75084),_=r(67074);let R=(0,_.ZP)(v())(e=>{let{theme:t}=e;return{padding:t.spacing(5)}}),N=e=>{let{msgs:t,hidden:r,user:n,contact:o}=e,d=(0,s.useRef)(null);(0,s.useEffect)(()=>{t&&t.length&&(c(),console.log("scrolldownto bottom")),console.log("msgs :>> ",t)},[t]);let c=()=>{d.current&&(r?d.current.scrollTop=Number.MAX_SAFE_INTEGER:d.current._container.scrollTop=Number.MAX_SAFE_INTEGER)},h=e=>{let{children:t}=e;return r?(0,i.jsx)(a.Z,{ref:d,sx:{p:5,height:"100%",overflowY:"auto",overflowX:"hidden"},children:t}):(0,i.jsx)(R,{ref:d,options:{wheelPropagation:!1},children:t})};return(0,i.jsx)(a.Z,{sx:{height:"calc(100vh - 310px)"},children:(0,i.jsx)(h,{children:t.map((e,r)=>{let s=e.user._id===n._id;return(0,i.jsxs)(a.Z,{sx:{display:"flex",flexDirection:s?"row-reverse":"row",mb:r!==t.length-1?3.75:void 0},children:[(0,i.jsx)("div",{children:(0,i.jsx)(l.Z,{skin:"light",color:"primary",sx:{width:"2rem",height:"2rem",fontSize:"0.875rem",ml:s?4:void 0,mr:s?void 0:4},...s?{}:{src:"/images/avatars/2.png",alt:o.firstName+" "+o.lastName},...s?{src:"/images/avatars/1.png",alt:n.firstName+" "+n.lastName}:{}})}),(0,i.jsx)(a.Z,{className:"chat-body",sx:{maxWidth:["calc(100% - 5.75rem)","75%","65%"]},children:(0,i.jsxs)(a.Z,{sx:{"&:not(:last-of-type)":{mb:3.5}},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(x.Z,{sx:{boxShadow:1,borderRadius:1,width:"fit-content",fontSize:"0.875rem",p:e=>e.spacing(3,4),ml:s?"auto":void 0,borderTopLeftRadius:s?void 0:0,borderTopRightRadius:s?0:void 0,color:s?"common.white":"text.primary",backgroundColor:s?"primary.main":"background.paper"},children:e.text}),(0,i.jsx)("br",{}),e.fileName&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(x.Z,{sx:{boxShadow:1,borderRadius:1,width:"fit-content",fontSize:"0.875rem",p:e=>e.spacing(3,4),ml:s?"auto":void 0,borderTopLeftRadius:s?void 0:0,borderTopRightRadius:s?0:void 0,color:s?"common.white":"text.primary",backgroundColor:s?"primary.main":"background.paper"},children:(0,i.jsx)("a",{href:"/uploads/message_file/".concat(e.fileName),target:"_blank",rel:"noreferrer",download:e.fileName.slice(14),children:e.fileName.slice(14)})})})]}),(0,i.jsx)(a.Z,{sx:{mt:1,display:"flex",alignItems:"center",justifyContent:s?"flex-end":"flex-start"},children:(0,i.jsx)(x.Z,{variant:"caption",sx:{color:"text.disabled"},children:e.createdAt?new Date(e.createdAt).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}):null})})]},r)})]},r)})})})};var I=r(86501);let z=(0,_.ZP)(a.Z)(e=>{let{theme:t}=e;return{flexGrow:1,height:"100%",display:"flex",borderRadius:1,alignItems:"center",flexDirection:"column",justifyContent:"center",backgroundColor:t.palette.action.hover}}),E=(0,_.ZP)(a.Z)(e=>{let{theme:t}=e;return{display:"flex",borderRadius:8,alignItems:"center",boxShadow:t.shadows[1],padding:t.spacing(1.25,4),justifyContent:"space-between",backgroundColor:t.palette.background.paper}}),T=(0,_.ZP)("form")(e=>{let{theme:t}=e;return{padding:t.spacing(0,5,5)}}),P=e=>{let{sender:t,hidden:r}=e,{user:n}=(0,b.a)(),[c,h]=(0,s.useState)([]),[p,m]=(0,s.useState)(""),[u,g]=(0,s.useState)();(0,s.useEffect)(()=>{let e=async()=>{let{data:e}=await w.Z.get("crms/communications/messages",{params:{user:n._id,sender:t._id}});h(e.messages)};e()},[t]);let f=async e=>{e.preventDefault();let r=new FormData;if(p.trim()){r.append("text",p.trim()),r.append("sender",t._id),r.append("user",n._id),r.append("messageFile",u),console.log("file :>> ",u);try{let{data:i}=await w.Z.post("crms/communications/message-file",r,{headers:{"Content-Type":"multipart/form-data"}});i.status?h([...c,i.message]):I.ZP.error(i.msg)}catch(s){}}g(null),m("")},Z=e=>{e.preventDefault(),console.log("event.target.files[0] :>> ",e.target.files[0]),e.target.files&&g(e.target.files[0])};return Object.keys(t).length?(0,i.jsxs)(a.Z,{sx:{flexGrow:1,width:"100%",height:"100%",backgroundColor:"action.hover"},children:[(0,i.jsx)(a.Z,{sx:{py:3,px:5,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:(0,i.jsx)(a.Z,{sx:{display:"flex",alignItems:"center"},children:(0,i.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,i.jsx)(o.Z,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{mr:4.5},badgeContent:(0,i.jsx)(a.Z,{component:"span",sx:{width:8,height:8,borderRadius:"50%",color:"success.main",boxShadow:e=>"0 0 0 2px ".concat(e.palette.background.paper),backgroundColor:"success.main"}}),children:(0,i.jsx)(l.Z,{src:"/images/avatars/2.png",alt:"Avatar",sx:{width:40,height:40}})}),(0,i.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,i.jsx)(x.Z,{sx:{color:"text.secondary"},children:t.firstName+" "+t.lastName}),(0,i.jsx)(x.Z,{variant:"body2",sx:{color:"text.disabled"},children:t.role})]})]})})}),(0,i.jsx)(N,{hidden:r,msgs:c,user:n,contact:t}),(0,i.jsx)(T,{onSubmit:f,children:(0,i.jsxs)(E,{children:[(0,i.jsx)(a.Z,{sx:{flexGrow:1,display:"flex",alignItems:"center"},children:(0,i.jsx)(d.Z,{fullWidth:!0,value:p,size:"small",placeholder:"Type your message hereâ€¦",onChange:e=>m(e.target.value),sx:{"& .MuiOutlinedInput-input":{pl:0},"& fieldset":{border:"0 !important"}}})}),(0,i.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsxs)(S.Z,{size:"small",component:"label",htmlFor:"upload-img",sx:{mr:2.75,color:"text.primary"},children:[(0,i.jsx)(j.Z,{icon:"mdi:attachment",fontSize:"1.375rem"}),(0,i.jsx)("input",{hidden:!0,type:"file",id:"upload-img",onChange:Z}),u&&u.name]}),u&&(0,i.jsx)(S.Z,{onClick(){g(null)},children:(0,i.jsx)(j.Z,{icon:"mdi:alpha-x-box-outline",fontSize:"1.375rem"})}),(0,i.jsx)(k.Z,{type:"submit",variant:"contained",children:"Send"})]})]})})]}):(0,i.jsx)(z,{sx:{borderTopLeftRadius:0,borderBottomLeftRadius:0,height:"calc(100vh - 170px)"},children:(0,i.jsx)(l.Z,{sx:{mb:5,pt:8,pb:7,px:7.5,width:110,height:110,boxShadow:3,"& svg":{color:"action.active"},backgroundColor:"background.paper"},children:(0,i.jsx)(j.Z,{icon:"mdi:message-outline",fontSize:"3.125rem"})})})};var A=r(61225),D=r(62097),L=r(94314);let M=()=>{let e=(0,D.Z)(),t=(0,A.Z)(e.breakpoints.down("lg")),[r,n]=(0,s.useState)({}),o=e=>{n(e)};return(0,i.jsxs)(a.Z,{className:"app-chat",sx:{width:"100%",display:"flex",borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.paper",boxShadow:6},children:[(0,i.jsx)(C,{hidden:t,handleChatClick:o}),(0,i.jsx)(P,{hidden:t,sender:r})]})};M.authGuard=!0,M.getLayout=e=>(0,i.jsx)(L.Z,{children:e});var B=M}},function(e){e.O(0,[6284,9799,4583,3816,3951,7836,7853,4314,9774,2888,179],function(){return e(e.s=73688)}),_N_E=e.O()}]);